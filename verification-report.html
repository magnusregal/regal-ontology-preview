<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Verification Report — Regal</title>
    <style>
        :root {
            --bg: #1a1a2e;
            --surface: #16213e;
            --text: #eee;
            --accent: #0f3460;
            --red: #e94560;
            --green: #4ecca3;
            --yellow: #ffc107;
            --blue: #00d9ff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 2rem;
            max-width: 1100px;
            margin: 0 auto;
        }
        h1 { color: var(--blue); margin-bottom: 0.5rem; }
        h2 { color: var(--green); margin: 2rem 0 1rem; border-bottom: 1px solid var(--accent); padding-bottom: 0.5rem; }
        h3 { color: var(--text); margin: 1.5rem 0 0.75rem; }
        a { color: var(--blue); }
        .meta { color: #888; margin-bottom: 2rem; font-size: 0.9rem; }
        .back-link { margin-bottom: 1rem; }
        table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.85rem; }
        th, td { padding: 0.5rem; text-align: left; border: 1px solid var(--accent); }
        th { background: var(--accent); color: var(--blue); }
        code { background: var(--accent); padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.85rem; }
        pre { background: var(--surface); padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; }
        .alert { padding: 1rem; border-radius: 6px; margin: 1rem 0; }
        .alert-critical { background: rgba(233, 69, 96, 0.2); border-left: 4px solid var(--red); }
        .alert-warning { background: rgba(255, 193, 7, 0.2); border-left: 4px solid var(--yellow); }
        .alert-info { background: rgba(78, 204, 163, 0.15); border-left: 4px solid var(--green); }
        .status-ok { color: var(--green); }
        .status-warn { color: var(--yellow); }
        .status-error { color: var(--red); }
    </style>
</head>
<body>
    <div class="back-link"><a href="index.html">← Back to Ontology</a></div>
    
    <h1>AWS Verification Report</h1>
    <div class="meta">
        Scan Date: 2026-02-22 | Profile: regal-dev, regal-release | Region: us-east-1, us-east-2
    </div>

    <h2>Executive Summary</h2>
    <table>
        <tr><th>Resource</th><th>Dev (865942198740)</th><th>Prod (975050223773)</th></tr>
        <tr><td>Lambda Functions</td><td>327 (285 + 42)</td><td>TBD</td></tr>
        <tr><td>RDS Instances</td><td>8</td><td>6</td></tr>
        <tr><td>API Gateways</td><td>30</td><td>14</td></tr>
        <tr><td>Amplify Apps</td><td>6</td><td>0</td></tr>
        <tr><td>CloudFormation Stacks</td><td>34</td><td>21</td></tr>
    </table>

    <div class="alert alert-critical">
        <strong>CRITICAL: Security Issue Confirmed</strong><br>
        Gobodo DB (<code>rcm-gobodo-db-stg</code>) is publicly accessible with port 5432 open to 0.0.0.0/0
    </div>

    <h2>Security Issue Details</h2>
    <table>
        <tr><th>Property</th><th>Value</th></tr>
        <tr><td>Instance</td><td><code>rcm-gobodo-db-stg</code></td></tr>
        <tr><td>Endpoint</td><td><code>rcm-gobodo-db-stg.cqhna2fiukih.us-east-1.rds.amazonaws.com</code></td></tr>
        <tr><td>Engine</td><td>PostgreSQL</td></tr>
        <tr><td>PubliclyAccessible</td><td class="status-error">TRUE</td></tr>
        <tr><td>Security Group</td><td><code>sg-09f4dfb35576fa76a</code></td></tr>
        <tr><td>Port 5432</td><td class="status-error">Open to 0.0.0.0/0</td></tr>
    </table>

    <h3>Remediation Steps</h3>
    <ol>
        <li>Modify security group <code>sg-09f4dfb35576fa76a</code> to restrict to VPC CIDR</li>
        <li>Set <code>PubliclyAccessible=False</code> on RDS instance</li>
        <li>Add VPN/bastion for developer access</li>
        <li>Enable SSL enforcement (<code>rds.force_ssl=1</code>)</li>
    </ol>

    <h2>RDS Instances</h2>

    <h3>Development Account</h3>
    <table>
        <tr><th>Instance</th><th>Engine</th><th>Status</th><th>Public</th></tr>
        <tr><td>keycloak-development</td><td>Aurora MySQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>keycloak-development-*-instance-1</td><td>Aurora MySQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>rcm-dsync-data-main-rds-dev</td><td>PostgreSQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>rcm-dsync-data-main-rds-stg</td><td>PostgreSQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>rcm-dsync-data-main-rds-dev-alex</td><td>PostgreSQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>rcm-dsync-data-main-rds-dev-jim</td><td>PostgreSQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>rcm-dsync-data-main-rds-dev-wei</td><td>PostgreSQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>rcm-gobodo-db-stg</td><td>PostgreSQL</td><td class="status-ok">available</td><td class="status-error">YES</td></tr>
    </table>

    <h3>Production Account</h3>
    <table>
        <tr><th>Instance</th><th>Engine</th><th>Status</th><th>Public</th></tr>
        <tr><td>keycloak-release-*-instance-1 (x5)</td><td>Aurora MySQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
        <tr><td>keycloak-v16-release-rdsdbinstance-*</td><td>Aurora MySQL</td><td class="status-ok">available</td><td class="status-ok">No</td></tr>
    </table>

    <div class="alert alert-warning">
        <strong>Note:</strong> No rcm-dsync RDS instances in production account. Salesforce sync not deployed to prod.
    </div>

    <h2>API Gateways</h2>

    <h3>Development Account (30 total)</h3>
    <table>
        <tr><th>API ID</th><th>Name</th><th>Purpose</th></tr>
        <tr><td><code>yqo32wi8cd</code></td><td>rcm-cdk-apigateway-development-pl</td><td>Main dev API (verified)</td></tr>
        <tr><td><code>fl1928grye</code></td><td>rcm-cdk-apigateway-staging-pl</td><td>Main staging API</td></tr>
        <tr><td><code>53omzua4f4</code></td><td>core-cdk-apigateway-development-pl</td><td>Core domain</td></tr>
        <tr><td><code>8wqcvx9i9l</code></td><td>creditblock-cdk-apigateway-development-pl</td><td>CreditBlock domain</td></tr>
        <tr><td><code>pf00xhquj1</code></td><td>cybersweep-cdk-apigateway-development-pl</td><td>CyberSweep domain</td></tr>
        <tr><td><code>kpuz40vgd7</code></td><td>vendor-cdk-apigateway-development-pl</td><td>Vendor domain</td></tr>
    </table>

    <h3>Production Account (14 total)</h3>
    <table>
        <tr><th>API ID</th><th>Name</th><th>Purpose</th></tr>
        <tr><td><code>gy0zwkmroe</code></td><td>rcm-cdk-apigateway-production-pl</td><td>Main prod API (verified)</td></tr>
        <tr><td><code>ndcltu5vvd</code></td><td>rcm-cdk-webhook-apigateway-production-pl</td><td>Prod webhooks (verified)</td></tr>
        <tr><td><code>e0b1zp7bw9</code></td><td>core-cdk-apigateway-release-pl</td><td>Core domain</td></tr>
        <tr><td><code>5ikno6dq92</code></td><td>creditblock-cdk-apigateway-release-pl</td><td>CreditBlock domain</td></tr>
        <tr><td><code>p1d8hit5r5</code></td><td>cybersweep-cdk-apigateway-release-pl</td><td>CyberSweep domain</td></tr>
        <tr><td><code>s96p77o4j4</code></td><td>vendor-cdk-apigateway-release-pl</td><td>Vendor domain</td></tr>
    </table>

    <h2>Amplify Apps</h2>
    <table>
        <tr><th>App Name</th><th>Domain</th><th>Account</th></tr>
        <tr><td>Regal-Product-Hub-Dev</td><td>di8ftbeldh0qk.amplifyapp.com</td><td>Dev</td></tr>
        <tr><td>Regal-Product-Hub-Stg</td><td>d2r0codbnevnxq.amplifyapp.com</td><td>Dev</td></tr>
        <tr><td>RegalCreditB2BWebDashboard</td><td>d3h9qkfgty36hl.amplifyapp.com</td><td>Dev</td></tr>
        <tr><td>partnerportal2023</td><td>d1f7cg9rxlwckc.amplifyapp.com</td><td>Dev</td></tr>
    </table>

    <div class="alert alert-info">
        <strong>Note:</strong> No Amplify apps in production account. Production may use different hosting.
    </div>

    <h2>Validation Against Ontology</h2>
    
    <h3>Confirmed</h3>
    <ul>
        <li class="status-ok">API Gateway IDs match for dev, staging, production</li>
        <li class="status-ok">Keycloak Aurora MySQL instances exist</li>
        <li class="status-ok">RDS sync databases exist in dev</li>
        <li class="status-ok">Amplify apps for Product Hub exist</li>
        <li class="status-ok">Lambda naming patterns match (core-cdk-*, creditblock-cdk-*, etc.)</li>
    </ul>

    <h3>Discrepancies</h3>
    <ul>
        <li class="status-warn">No rcm-dsync resources in production</li>
        <li class="status-warn">No Amplify apps in production account</li>
        <li class="status-warn">Neo4j stack exists (<code>rcm-gobodo-neo4j-stg</code>) — not documented</li>
        <li class="status-warn">More Lambda functions than documented</li>
    </ul>

    <h2>Commands Used</h2>
    <pre>
# Identity
aws sts get-caller-identity --profile regal-dev

# RDS
aws rds describe-db-instances --profile regal-dev --region us-east-1 \
  --query 'DBInstances[*].[DBInstanceIdentifier,Engine,PubliclyAccessible]'

# API Gateway
aws apigateway get-rest-apis --profile regal-dev --region us-east-1

# Lambda
aws lambda list-functions --profile regal-dev --region us-east-1

# Amplify
aws amplify list-apps --profile regal-dev --region us-east-1

# Security Groups
aws ec2 describe-security-groups --profile regal-dev --region us-east-1 \
  --group-ids sg-09f4dfb35576fa76a
    </pre>

</body>
</html>
